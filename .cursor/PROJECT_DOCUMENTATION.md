# üìö –ü–û–õ–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø –ü–†–û–ï–ö–¢–ê VERANDA

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 03.10.2025  
**–í–µ—Ä—Å–∏—è:** 2.0 (–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏)  
**–î–æ–º–µ–Ω:** veranda.my  
**–°—Ç–∞—Ç—É—Å:** Production

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
4. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
5. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–æ–≤)
6. [Backend API](#backend-api)
7. [Frontend](#frontend)
8. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö MongoDB](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö-mongodb)
9. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
10. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
11. [–î–µ–ø–ª–æ–π](#–¥–µ–ø–ª–æ–π)
12. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
13. [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## üéØ –û–ë–ó–û–† –ü–†–û–ï–ö–¢–ê

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
**Veranda** - –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∏ –±–∞—Ä–∞ –≤ –ù—è—á–∞–Ω–≥–µ (–í—å–µ—Ç–Ω–∞–º), –≤–∫–ª—é—á–∞—é—â–∞—è:
- –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π —Å–∞–π—Ç (RU, EN, VI)
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–æ—Ä–∑–∏–Ω–æ–π –∏ –∑–∞–∫–∞–∑–∞–º–∏
- –°–∏—Å—Ç–µ–º—É —Å–æ–±—ã—Ç–∏–π –∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Poster POS —Å–∏—Å—Ç–µ–º–æ–π
- –ü–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ SePay
- Telegram –±–æ—Ç–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è
- –ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (–ø—Ä–æ—Å–º–æ—Ç—Ä –º–µ–Ω—é, –∑–∞–∫–∞–∑)
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- –ú–µ–Ω–µ–¥–∂–µ—Ä—ã (–ø–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–∫–∞–∑–∞—Ö/–ø–ª–∞—Ç–µ–∂–∞—Ö)

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         veranda.my (Production)         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Frontend   ‚îÇ‚îÄ‚îÄ‚îÄ>‚îÇ   Backend    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   (PHP 8.x)  ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÇ  (Node.js)   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   Port 80    ‚îÇ    ‚îÇ   Port 3003  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                    ‚îÇ          ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                ‚îÇ                        ‚îÇ
‚îÇ       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ       ‚îÇ    MongoDB      ‚îÇ               ‚îÇ
‚îÇ       ‚îÇ  Port 27017     ‚îÇ               ‚îÇ
‚îÇ       ‚îÇ   DB: veranda   ‚îÇ               ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã:    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ  ‚Ä¢ Poster POS API    ‚îÇ
    ‚îÇ  ‚Ä¢ SePay Payments    ‚îÇ
    ‚îÇ  ‚Ä¢ Telegram Bot API  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Frontend (PHP)**
   - –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –†–∞–±–æ—Ç–∞ —Å —Å–µ—Å—Å–∏—è–º–∏
   - –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å

2. **Backend (Node.js)**
   - REST API
   - –ü—Ä–æ–∫—Å–∏ –¥–ª—è Poster API
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   - Rate limiting

3. **MongoDB**
   - –ö—ç—à –º–µ–Ω—é
   - –°–æ–±—ã—Ç–∏—è
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –¢–µ–∫—Å—Ç—ã –∏ –ø–µ—Ä–µ–≤–æ–¥—ã
   - –ê–¥–º–∏–Ω-–ª–æ–≥–∏

4. **Telegram Bot (Node.js)**
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö

---

## üíª –¢–ï–•–ù–û–õ–û–ì–ò–ò

### Backend
- **Node.js** 18.x
- **Express.js** 4.x - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Axios** - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Poster API
- **MongoDB Driver** - —Ä–∞–±–æ—Ç–∞ —Å –ë–î
- **Helmet** - security headers
- **CORS** - –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **express-rate-limit** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞
- **compression** - —Å–∂–∞—Ç–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- **morgan** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

### Frontend
- **PHP** 8.x
- **MongoDB PHP Library** - —Ä–∞–±–æ—Ç–∞ —Å –ë–î
- **Dotenv** - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **Vanilla JavaScript** - –±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤
- **CSS3** - —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **MongoDB** 7.0
- **19 –∫–æ–ª–ª–µ–∫—Ü–∏–π**
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è** –ø–æ –∫–ª—é—á–µ–≤—ã–º –ø–æ–ª—è–º

### DevOps
- **PM2** - process manager –¥–ª—è Node.js
- **Git** - –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Nginx** - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
- **Apache** - PHP handler
- **SSH** - —É–¥–∞–ª–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## üîß –£–°–¢–ê–ù–û–í–ö–ê –ò –ù–ê–°–¢–†–û–ô–ö–ê

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

```bash
# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞:
- CPU: 2 —è–¥—Ä–∞
- RAM: 2 GB
- Disk: 10 GB
- OS: Ubuntu 20.04+ / Debian 11+

# –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ:
- Node.js 18.x
- PHP 8.x
- MongoDB 7.x
- Nginx 1.x
- Composer 2.x
- PM2 5.x
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ

#### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
cd /var/www/veranda_my_usr/data/www/
git clone git@github.com:zapleoceo/restpublic.git veranda.my
cd veranda.my
```

#### 2. –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
```bash
cp .cursor/.env.veranda .env
nano .env  # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –∏ –∫–ª—é—á–∏
```

**–í–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```env
# Backend Configuration
BACKEND_URL=http://localhost:3003
PORT=3003

# MongoDB Configuration
MONGODB_URL=mongodb://localhost:27017
MONGODB_DB_NAME=veranda

# Poster POS API
POSTER_API_TOKEN=<–≤–∞—à_—Ç–æ–∫–µ–Ω>
POSTER_API_BASE_URL=https://joinposter.com/api

# SePay Payment System
SEPAY_API_TOKEN=<–≤–∞—à_—Ç–æ–∫–µ–Ω>
SEPAY_INCOMING_API_TOKEN=<–≤–∞—à_—Ç–æ–∫–µ–Ω_–¥–ª—è_webhook>

# Telegram Bot
TELEGRAM_BOT_TOKEN=<–≤–∞—à_—Ç–æ–∫–µ–Ω>
TELEGRAM_GROUP_ID=<id_–≥—Ä—É–ø–ø—ã>

# API Authorization
API_AUTH_TOKEN=<—Å–ª—É—á–∞–π–Ω–∞—è_—Å—Ç—Ä–æ–∫–∞_64_—Å–∏–º–≤–æ–ª–∞>
```

#### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**Backend (Node.js):**
```bash
cd backend
npm install --production
cd ..
```

**Frontend (PHP):**
```bash
composer install --no-dev --optimize-autoloader
```

**Telegram Bot:**
```bash
cd telegram-bot
npm install --production
npm run build
cd ..
```

#### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB

```bash
# –ò–º–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å backup)
mongorestore --db veranda /path/to/backup/veranda/

# –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –±–∞–∑—É
mongosh
> use veranda
> db.createCollection("menu")
> db.createCollection("events")
> db.createCollection("users")
> db.createCollection("admin_texts")
> exit
```

#### 5. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

**Backend:**
```bash
cd backend
pm2 start ecosystem.config.js
cd ..
```

**Telegram Bot:**
```bash
cd telegram-bot  
pm2 start ecosystem.config.cjs
cd ..
```

**–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2:**
```bash
pm2 save
pm2 startup  # –°–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
```

#### 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cron –∑–∞–¥–∞—á

```bash
crontab -e
```

–î–æ–±–∞–≤–∏—Ç—å:
```cron
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –º–µ–Ω—é –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
*/30 * * * * curl -X POST http://localhost:3003/api/cache/update-menu >/dev/null 2>&1

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ GameZone (—É—Ç—Ä–æ)
1 3 * * * /usr/bin/php /var/www/veranda_my_usr/data/www/veranda.my/send_tomorrow_to_gamezone.php >/dev/null 2>&1

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ GameZone (–≤–µ—á–µ—Ä)
12 14 * * * /usr/bin/php /var/www/veranda_my_usr/data/www/veranda.my/send_tomorrow_evening_to_gamezone.php >/dev/null 2>&1

# –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ Sila
0 15 * * 0 /usr/bin/php /var/www/veranda_my_usr/data/www/veranda.my/send_weekly_to_sila.php >/dev/null 2>&1

# Telegram cron
* * * * * /usr/bin/php /var/www/veranda_my_usr/data/www/veranda.my/admin/telegram/cron.php >/dev/null 2>&1
```

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í

### –ö–æ—Ä–Ω–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `index.php` | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –º–∏–Ω–∏-–º–µ–Ω—é –∏ –≤–∏–¥–∂–µ—Ç–æ–º —Å–æ–±—ã—Ç–∏–π |
| `menu.php` | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–Ω–æ–≥–æ –º–µ–Ω—é (–≤–µ—Ä—Å–∏—è 1) |
| `menu2.php` | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–Ω–æ–≥–æ –º–µ–Ω—é (–≤–µ—Ä—Å–∏—è 2, –æ—Å–Ω–æ–≤–Ω–∞—è) |
| `events.php` | –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏ |
| `webhook-handler.php` | Webhook –¥–ª—è –ø—Ä–∏–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –æ—Ç SePay |
| `composer.json` | PHP –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| `.env` | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ù–ï –≤ Git!) |
| `deploy.sh` | –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è |

### Backend (Node.js)

```
backend/
‚îú‚îÄ‚îÄ server.js                 # Express —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ config.env                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è backend
‚îú‚îÄ‚îÄ ecosystem.config.js       # PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ package.json              # Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ
‚îú‚îÄ‚îÄ routes/                   # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ menu.js              # /api/menu - –º–µ–Ω—é –∏ –ø—Ä–æ–¥—É–∫—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ poster.js            # /api/poster - –ø—Ä–æ–∫—Å–∏ –¥–ª—è Poster API
‚îÇ   ‚îú‚îÄ‚îÄ cache.js             # /api/cache - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞
‚îÇ   ‚îú‚îÄ‚îÄ tables.js            # /api/tables - —Å–ø–∏—Å–æ–∫ —Å—Ç–æ–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ auth.js              # /api/auth - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ user.js              # /api/user - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ
‚îî‚îÄ‚îÄ services/
    ‚îî‚îÄ‚îÄ posterService.js     # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Poster API
```

### PHP Classes

```
classes/
‚îú‚îÄ‚îÄ MenuCache.php                # –ö—ç—à –º–µ–Ω—é –∏–∑ MongoDB + –∞–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥ –±–ª—é–¥
‚îú‚îÄ‚îÄ EventsService.php            # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏
‚îú‚îÄ‚îÄ TranslationService.php       # –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (MongoDB)
‚îú‚îÄ‚îÄ PageContentService.php       # –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü
‚îú‚îÄ‚îÄ UserAuth.php                 # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ TelegramService.php          # –†–∞–±–æ—Ç–∞ —Å Telegram API
‚îú‚îÄ‚îÄ SePayTransactionService.php  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
‚îú‚îÄ‚îÄ SePayApiService.php          # SePay API –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ ImageService.php             # –†–∞–±–æ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
‚îú‚îÄ‚îÄ SettingsService.php          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ TablesCache.php              # –ö—ç—à —Å—Ç–æ–ª–æ–≤
‚îú‚îÄ‚îÄ Logger.php                   # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ RateLimiter.php              # Rate limiting
‚îî‚îÄ‚îÄ SecurityValidator.php        # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```

### –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å

```
admin/
‚îú‚îÄ‚îÄ index.php              # –î–∞—à–±–æ—Ä–¥
‚îú‚îÄ‚îÄ auth/                  # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ login.php
‚îÇ   ‚îú‚îÄ‚îÄ logout.php
‚îÇ   ‚îî‚îÄ‚îÄ telegram.php
‚îÇ
‚îú‚îÄ‚îÄ events/                # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ index.php
‚îÇ   ‚îî‚îÄ‚îÄ api.php
‚îÇ
‚îú‚îÄ‚îÄ pages/                 # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
‚îÇ   ‚îî‚îÄ‚îÄ index.php
‚îÇ
‚îú‚îÄ‚îÄ settings/              # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ index.php
‚îÇ
‚îú‚îÄ‚îÄ logs/                  # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ index.php
‚îÇ
‚îú‚îÄ‚îÄ database/              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ index.php
‚îÇ   ‚îú‚îÄ‚îÄ mongodb-viewer.php
‚îÇ   ‚îî‚îÄ‚îÄ init-*.php         # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–π
‚îÇ
‚îî‚îÄ‚îÄ includes/              # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ header.php
    ‚îú‚îÄ‚îÄ footer.php
    ‚îú‚îÄ‚îÄ sidebar.php
    ‚îî‚îÄ‚îÄ auth-check.php     # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```

---

## üîå BACKEND API

### –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**URL:** `http://localhost:3003` (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)  
**CORS:** `https://veranda.my`  
**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** `X-API-Token` header  
**Rate Limit:** 5 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫—É–Ω–¥—É

### Endpoints

#### Health Check
```http
GET /api/health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "timestamp": "2025-10-03T18:00:00.000Z",
  "uptime": 123456,
  "environment": "production"
}
```

---

#### –ú–µ–Ω—é (–ø–æ–ª–Ω–æ–µ)
```http
GET /api/menu
Headers: X-API-Token: <token>
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "categories": [
    {
      "category_id": "2",
      "category_name": "–ï–¥–∞",
      "category_photo": "/upload/...",
      "sort_order": "1"
    }
  ],
  "products": [
    {
      "product_id": "36",
      "product_name": "–®–∞—É—Ä–º–∞",
      "price": "6000000",
      "price_normalized": 60000,
      "price_formatted": "60 000",
      "image_url": "https://joinposter.com/upload/..."
    }
  ],
  "timestamp": "2025-10-03T18:00:00.000Z"
}
```

---

#### –ü—Ä–æ–¥—É–∫—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```http
GET /api/menu/categories/:categoryId/products
Headers: X-API-Token: <token>
```

---

#### –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```http
GET /api/menu/categories/:categoryId/popular?limit=5
Headers: X-API-Token: <token>
```

---

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –º–µ–Ω—é
```http
POST /api/cache/update-menu
Headers: X-API-Token: <token>
```

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Poster API –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ MongoDB

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–ö—ç—à –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ",
  "modifiedCount": 1,
  "timestamp": "2025-10-03T18:00:00.000Z"
}
```

---

#### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
```http
POST /api/auth/telegram
Content-Type: application/json

{
  "telegram_id": "123456789",
  "phone": "+84349338758",
  "first_name": "John",
  "last_name": "Doe"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "Authentication successful",
  "redirectUrl": "https://veranda.my/menu2.php?auth=success&session=<token>"
}
```

---

## üåê FRONTEND

### –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (index.php)

**–§—É–Ω–∫—Ü–∏–∏:**
- Hero —Å–µ–∫—Ü–∏—è —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
- –ú–∏–Ω–∏-–º–µ–Ω—é (5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±–ª—é–¥ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é)
- –í–∏–¥–∂–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π
- –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –º–µ–Ω—é

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- PHP —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
- MongoDB –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (`PageContentService`)
- MongoDB –¥–ª—è –º–µ–Ω—é (`MenuCache`)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –±–ª—é–¥

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```php
// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –ø—Ä–∏ –∑–∞—Ö–æ–¥–µ (—Ñ–æ–Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å)
updateMenuCacheAsync(); // ‚Üí POST localhost:3003/api/cache/update-menu
```

---

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–µ–Ω—é (menu2.php)

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü–æ–ª–Ω–æ–µ –º–µ–Ω—é –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ, –ø–æ —Ü–µ–Ω–µ, –ê-–Ø)
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**
1. **MongoDB –∫—ç—à** (primary)
2. **Backend API** (fallback)

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (MongoDB PHP driver): –º–∞—Å—Å–∏–≤—ã –∏–∑ MongoDB –º–æ–≥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∫–∞–∫ `BSONArray`. –î–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ç–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `foreach` –∏ —Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –æ–±—ã—á–Ω—ã–π PHP-–º–∞—Å—Å–∏–≤; –Ω–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ `is_array()` –¥–ª—è —Ç–∞–∫–∏—Ö –ø–æ–ª–µ–π.

**JavaScript —Ñ—É–Ω–∫—Ü–∏–∏:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω–æ–π (`cart.js`)
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram/Google/FB
- AJAX –∑–∞–∫–∞–∑—ã —á–µ—Ä–µ–∑ Poster API

---

### –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π (events.php)

**–§—É–Ω–∫—Ü–∏–∏:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏
- –ù–µ–¥–µ–ª—å–Ω—ã–π –≤–∏–¥ (–ü–Ω-–í—Å)
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ —Å–æ–±—ã—Ç–∏—è
- –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å
- Lazy loading –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**
```javascript
fetch(`/api/events.php?start_date=${startDate}&days=14&language=${language}`)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —Å **–Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏** (–Ω–µ —Å —Å–µ–≥–æ–¥–Ω—è!)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–π –¥–Ω–µ–π
- –ü—É—Å—Ç—ã–µ –¥–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Å–≤—è–∑–∞—Ç—å—Å—è

---

## üíæ –ë–ê–ó–ê –î–ê–ù–ù–´–• MONGODB

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î: `veranda`

#### –ö–æ–ª–ª–µ–∫—Ü–∏—è: `menu`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö—ç—à –º–µ–Ω—é –æ—Ç Poster API

**–î–æ–∫—É–º–µ–Ω—Ç—ã:**
- `current_menu` - —Ç–µ–∫—É—â–µ–µ –º–µ–Ω—é (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + –ø—Ä–æ–¥—É–∫—Ç—ã)
- `current_tables` - —Å–ø–∏—Å–æ–∫ —Å—Ç–æ–ª–æ–≤ –∏ –∑–∞–ª—ã

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "_id": "current_menu",
  "data": { /* –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ */ },
  "categories": [ /* –º–∞—Å—Å–∏–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */ ],
  "products": [ /* –º–∞—Å—Å–∏–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ */ ],
  "updated_at": ISODate("2025-10-03...")
}
```

```json
{
  "_id": "current_tables",
  "tables": [ /* –º–∞—Å—Å–∏–≤ —Å—Ç–æ–ª–æ–≤ */ ],
  "halls": [
    { "hall_id": "1", "hall_name": "–°—Ü–µ–Ω–∞" },
    { "hall_id": "2", "hall_name": "Veranda" }
  ],
  "updated_at": ISODate("2025-10-09...")
}
```

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–ª–æ–≤ –ø–æ—Å—Ç—É–ø–∞—é—Ç –∏–∑ Poster API `spots.getSpotTablesHalls` (Node.js backend) –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `menu.current_tables.halls`.

---

#### –ö–æ–ª–ª–µ–∫—Ü–∏—è: `events`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–±—ã—Ç–∏—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞

**–ü–æ–ª—è:**
```json
{
  "_id": ObjectId("..."),
  "title_ru": "–ô–æ–≥–∞",
  "title_en": "Yoga",
  "title_vi": "Yoga",
  "description_ru": "...",
  "description_en": "...",
  "description_vi": "...",
  "date": "2025-10-03",
  "time": "08:00",
  "conditions_ru": "250.000 VND",
  "is_active": true,
  "category": "–ú—É–∑—ã–∫–∞–ª—å–Ω–æ–µ",
  "created_at": ISODate("...")
}
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- `date` (ascending)
- `is_active` (ascending)

---

#### –ö–æ–ª–ª–µ–∫—Ü–∏—è: `users`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

**–ü–æ–ª—è:**
```json
{
  "_id": ObjectId("..."),
  "phone": "+84349338758",
  "name": "John",
  "email": "user@example.com",
  "telegram_id": "123456789",
  "poster_client_id": "12345",
  "created_at": ISODate("..."),
  "last_login": ISODate("...")
}
```

---

#### –ö–æ–ª–ª–µ–∫—Ü–∏—è: `sepay_transactions`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–ª–∞—Ç–µ–∂–∏ –æ—Ç SePay

**–ü–æ–ª—è:**
```json
{
  "_id": ObjectId("..."),
  "transaction_id": "ABC123",
  "amount": 100000,
  "content": "Payment description",
  "gateway": "MB BANK",
  "transaction_date": "2025-10-03 18:00:00",
  "webhook_received_at": ISODate("..."),
  "telegram_sent": true,
  "telegram_sent_at": ISODate("...")
}
```

---

#### –ö–æ–ª–ª–µ–∫—Ü–∏—è: `admin_texts`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–µ—Ä–µ–≤–æ–¥—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

**–ü–æ–ª—è:**
```json
{
  "_id": ObjectId("..."),
  "key": "menu.title_v2",
  "translations": {
    "ru": "–ù–∞—à–µ –º–µ–Ω—é v2",
    "en": "Our Menu v2",
    "vi": "Th·ª±c ƒë∆°n c·ªßa ch√∫ng t√¥i v2"
  },
  "category": "menu",
  "published": true,
  "created_at": ISODate("..."),
  "updated_at": ISODate("...")
}
```

---

#### –ö–æ–ª–ª–µ–∫—Ü–∏—è: `page_content`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü (About, Hero –∏ —Ç.–¥.)

**–ü–æ–ª—è:**
```json
{
  "_id": ObjectId("..."),
  "page": "home",
  "section": "hero",
  "content_ru": "...",
  "content_en": "...",
  "content_vi": "...",
  "updated_at": ISODate("...")
}
```

---

#### –ö–æ–ª–ª–µ–∫—Ü–∏—è: `admin_logs`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

---

#### –ö–æ–ª–ª–µ–∫—Ü–∏—è: `settings`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã

---

#### –ö–æ–ª–ª–µ–∫—Ü–∏—è: `user_sessions`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

#### –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–ª–ª–µ–∫—Ü–∏–π (18):
1. `admin_settings`
2. `admin_logs`
3. `admin_texts`
4. `admin_texts_backup`
5. `admin_users`
6. `configs`
7. `event_images.files`
8. `event_images.chunks`
9. `events`
10. `menu`
11. `page_content`
12. `rate_limits`
13. `sepay_transactions`
14. `settings`
15. `transactions`
16. `translations`
17. `users`
18. `user_sessions`

---

## üîó –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### 1. Poster POS API

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://dev.joinposter.com/docs/v3

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–Ω—é (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø—Ä–æ–¥—É–∫—Ç—ã)
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç–æ–ª–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–¥–∞–∂

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** Token –≤ query –ø–∞—Ä–∞–º–µ—Ç—Ä–µ
```
https://joinposter.com/api/menu.getProducts?token=<POSTER_API_TOKEN>
```

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í –ø–∞–º—è—Ç–∏ (PosterService): 5 –º–∏–Ω—É—Ç
- –í MongoDB (MenuCache): 30 –º–∏–Ω—É—Ç
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ cron –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç

---

### 2. SePay Payment System

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://my.sepay.vn/

**Webhook URL:** `https://veranda.my/webhook-handler.php`

**–§–æ—Ä–º–∞—Ç webhook:**
```json
{
  "id": "transaction_id",
  "transferAmount": 100000,
  "content": "Payment description",
  "gateway": "MB BANK",
  "accountNumber": "1234567890",
  "transactionDate": "2025-10-03 18:00:00"
}
```

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** `Authorization: Apikey <SEPAY_INCOMING_API_TOKEN>`

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
1. –ü–æ–ª—É—á–∞–µ—Ç webhook –æ—Ç SePay
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ MongoDB (`sepay_transactions`)
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
4. –ü–æ–º–µ—á–∞–µ—Ç –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ

---

### 3. Telegram Bot

**Bot:** @RestPublic_bot

**–§—É–Ω–∫—Ü–∏–∏:**
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–∞—Ö

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í–æ–π—Ç–∏" –Ω–∞ —Å–∞–π—Ç–µ
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Telegram –±–æ—Ç
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç (–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞)
4. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ `/api/auth/telegram`
5. Backend —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é
6. –ë–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É —Å —Ç–æ–∫–µ–Ω–æ–º —Å–µ—Å—Å–∏–∏
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

1. **–í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ .env** - –ù–ï–¢ —Ö–∞—Ä–¥–∫–æ–¥–∞
2. **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞
3. **CSRF –∑–∞—â–∏—Ç–∞** - –≤ —Ñ–æ—Ä–º–∞—Ö –∞–¥–º–∏–Ω–∫–∏
4. **XSS –∑–∞—â–∏—Ç–∞** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–æ–≤
5. **SQL Injection** - –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º MongoDB
6. **Session hijacking** - –∑–∞—â–∏—Ç–∞ —Å–µ—Å—Å–∏–π

### Rate Limiting

**Backend API:**
- General: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ / 15 –º–∏–Ω—É—Ç
- API endpoints: 5 –∑–∞–ø—Ä–æ—Å–æ–≤ / —Å–µ–∫—É–Ω–¥—É
- Auth endpoints: 2 –∑–∞–ø—Ä–æ—Å–∞ / —Å–µ–∫—É–Ω–¥—É

**PHP API:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `RateLimiter` class
- –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ MongoDB

### –í–∞–ª–∏–¥–∞—Ü–∏—è

**SecurityValidator class:**
```php
SecurityValidator::validatePhone($phone);
SecurityValidator::validateEmail($email);
SecurityValidator::sanitizeInput($input);
SecurityValidator::validateCSRF($token);
```

---

## üöÄ –î–ï–ü–õ–û–ô

### –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è

```bash
# 1. –õ–æ–∫–∞–ª—å–Ω–æ - –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .
git commit -m "Description"
git push origin main

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
ssh veranda "cd /var/www/veranda_my_usr/data/www/veranda.my && git pull origin main"

# 3. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
ssh veranda "cd /var/www/veranda_my_usr/data/www/veranda.my/backend && npm install"
ssh veranda "cd /var/www/veranda_my_usr/data/www/veranda.my && composer install"

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
ssh veranda "pm2 restart all"

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
ssh veranda "pm2 status"
ssh veranda "pm2 logs --lines 20"
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

```bash
ssh veranda "cd /var/www/veranda_my_usr/data/www/veranda.my && ./deploy.sh"
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç deploy.sh:**
1. –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git reset --hard`)
2. –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–¥ (`git pull origin main`)
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (npm + composer)
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç PM2 —Å–µ—Ä–≤–∏—Å—ã
5. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –õ–û–ì–ò

### PM2 Monitoring

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
pm2 status

# –õ–æ–≥–∏ (–≤—Å–µ)
pm2 logs

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
pm2 logs veranda-backend --lines 100

# –ú–µ—Ç—Ä–∏–∫–∏
pm2 monit
```

### –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–õ–æ–≥–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞ (Frontend/Backend):**
- –ü—É—Ç—å: `/var/www/veranda_my_usr/data/logs/`
- –§–∞–π–ª—ã:
  - `veranda.my-frontend.access.log`
  - `veranda.my-frontend.error.log`
  - `veranda.my-backend.access.log`
  - `veranda.my-backend.error.log`

**PM2 –ª–æ–≥–∏ Node.js:**
- –ü—É—Ç—å: `/var/www/veranda_my_usr/data/.pm2/logs/`
- –§–∞–π–ª—ã:
  - `veranda-backend-out.log` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥
  - `veranda-backend-error.log` - –æ—à–∏–±–∫–∏
  - `veranda-backend-combined.log` - –≤—Å–µ –≤–º–µ—Å—Ç–µ

**SePay webhook –ª–æ–≥–∏:**
- –ü—É—Ç—å: `/var/www/veranda_my_usr/data/www/veranda.my/logs/sepay_webhook.log`
- –§–æ—Ä–º–∞—Ç: `YYYY-MM-DD HH:MM:SS - MESSAGE`

**Admin –ª–æ–≥–∏ (MongoDB):**
```bash
mongosh veranda --eval 'db.admin_logs.find().sort({timestamp:-1}).limit(10).pretty()'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

```bash
# Backend API
curl http://localhost:3003/api/health

# Frontend
curl -I https://veranda.my/

# MongoDB
mongosh veranda --eval 'db.adminCommand({ping: 1})'

# PM2 —Å–µ—Ä–≤–∏—Å—ã
pm2 status
```

---

## üîß –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú

### –ú–µ–Ω—é –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
1. Backend –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. MongoDB –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
3. –ö—ç—à —É—Å—Ç–∞—Ä–µ–ª

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend
curl http://localhost:3003/api/menu

# –û–±–Ω–æ–≤–∏—Ç—å –∫—ç—à
curl -X POST http://localhost:3003/api/cache/update-menu

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend
pm2 restart veranda-backend
```

–î–ª—è PHP-–æ—à–∏–±–æ–∫ —Å–º–æ—Ç—Ä–µ—Ç—å:
```bash
tail -f /var/www/veranda_my_usr/data/logs/veranda.my-backend.error.log
```

---

### –°–æ–±—ã—Ç–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
1. EventsService –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MongoDB
2. –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
3. JavaScript –æ—à–∏–±–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ –ë–î
mongosh veranda --eval 'db.events.countDocuments({is_active: true})'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
curl "https://veranda.my/api/events.php?start_date=2025-10-03&days=14"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f /var/log/php_errors.log
```

---

### Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –∫–ª—é—á
2. MongoDB –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
3. Telegram –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook –≤—Ä—É—á–Ω—É—é
curl -X POST https://veranda.my/webhook-handler.php \
  -H "Authorization: Apikey <SEPAY_INCOMING_API_TOKEN>" \
  -H "Content-Type: application/json" \
  -d '{"id":"test123","transferAmount":100000,"content":"Test"}'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f logs/sepay_webhook.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram bot
pm2 logs veranda-telegram-bot
```

---

### Backend –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ
2. –ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç
3. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
pm2 logs veranda-backend --err --lines 50

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç
ss -tulpn | grep 3003

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–º—è—Ç—å
pm2 monit
```

---

## üé® –ú–£–õ–¨–¢–ò–Ø–ó–´–ß–ù–û–°–¢–¨

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏

- **ru** - –†—É—Å—Å–∫–∏–π (–æ—Å–Ω–æ–≤–Ω–æ–π)
- **en** - English
- **vi** - Ti·∫øng Vi·ªát

### –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–µ—Ä–µ–≤–æ–¥—ã

**1. MongoDB (`admin_texts` –∫–æ–ª–ª–µ–∫—Ü–∏—è):**
- –ü–µ—Ä–µ–≤–æ–¥—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–∫–Ω–æ–ø–∫–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∏, –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
- –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ —Ä—É—Å—Å–∫–∏–π

**2. PHP –∫–æ–¥ (`MenuCache.php`):**
- –ü–µ—Ä–µ–≤–æ–¥—ã –Ω–∞–∑–≤–∞–Ω–∏–π –±–ª—é–¥
- –•–∞—Ä–¥–∫–æ–¥-—Å–ª–æ–≤–∞—Ä—å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞
- –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –±–ª—é–¥–∞

**3. MongoDB (`events` –∫–æ–ª–ª–µ–∫—Ü–∏—è):**
- –ü–µ—Ä–µ–≤–æ–¥—ã —Å–æ–±—ã—Ç–∏–π (title, description, conditions)
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

**TranslationService:**
```php
$translationService = new TranslationService();
echo $translationService->get('menu.title_v2', '–ù–∞—à–µ –º–µ–Ω—é v2');
// –ù–∞ —Ä—É—Å—Å–∫–æ–º: "–ù–∞—à–µ –º–µ–Ω—é v2"
// –ù–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º: "Our Menu v2"  
// –ù–∞ –≤—å–µ—Ç–Ω–∞–º—Å–∫–æ–º: "Th·ª±c ƒë∆°n c·ªßa ch√∫ng t√¥i v2"
```

**–°–º–µ–Ω–∞ —è–∑—ã–∫–∞:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —è–∑—ã–∫–æ–≤–æ–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
2. AJAX –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/language/change.php`
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–µ—Å—Å–∏—è –∏ cookie
4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
5. –í—Å–µ —Ç–µ–∫—Å—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ

---

## üîÑ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –ó–ê–î–ê–ß–ò (CRON)

### –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á

```cron
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –º–µ–Ω—é (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
*/30 * * * * curl -X POST http://localhost:3003/api/cache/update-menu

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ GameZone - –∑–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 03:01)
1 3 * * * /usr/bin/php .../send_tomorrow_to_gamezone.php

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ GameZone - –∑–∞–≤—Ç—Ä–∞ –≤–µ—á–µ—Ä–æ–º (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 14:12)
12 14 * * * /usr/bin/php .../send_tomorrow_evening_to_gamezone.php

# –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ Sila (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 15:00)
0 15 * * 0 /usr/bin/php .../send_weekly_to_sila.php

# Telegram cron (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
* * * * * /usr/bin/php .../admin/telegram/cron.php
```

---

## üìù –ö–ê–ö –°–û–ó–î–ê–¢–¨ –ü–û–î–û–ë–ù–´–ô –ü–†–û–ï–ö–¢

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PHP 8.x
sudo apt-get install -y php8.2 php8.2-fpm php8.2-mongodb php8.2-curl php8.2-mbstring

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB
wget -qO- https://www.mongodb.org/static/pgp/server-7.0.asc | sudo apt-key add -
echo "deb http://repo.mongodb.org/apt/ubuntu focal/mongodb-org/7.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list
sudo apt-get update
sudo apt-get install -y mongodb-org

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Composer
php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
php composer-setup.php
sudo mv composer.phar /usr/local/bin/composer

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2
sudo npm install -g pm2
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞

```bash
mkdir -p veranda.my/{backend,classes,components,admin,api,css,js,images,logs}
cd veranda.my
```

### –®–∞–≥ 3: Backend (Express + Poster API)

**server.js:**
```javascript
const express = require('express');
const cors = require('cors');
require('dotenv').config();

const app = express();
app.use(cors());
app.use(express.json());

// Health check
app.get('/api/health', (req, res) => {
  res.json({ status: 'ok' });
});

// Poster API proxy
const posterService = require('./services/posterService');
app.get('/api/menu', async (req, res) => {
  const categories = await posterService.getCategories();
  const products = await posterService.getProducts();
  res.json({ categories, products });
});

app.listen(3003, () => console.log('Server running on 3003'));
```

### –®–∞–≥ 4: MongoDB –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**MenuCache.php:**
```php
class MenuCache {
    private $client;
    private $menuCollection;
    
    public function __construct() {
        $mongoUrl = $_ENV['MONGODB_URL'];
        $dbName = $_ENV['MONGODB_DB_NAME'];
        
        $this->client = new MongoDB\Client($mongoUrl);
        $this->menuCollection = $this->client->$dbName->menu;
    }
    
    public function getMenu() {
        return $this->menuCollection->findOne(['_id' => 'current_menu']);
    }
}
```

### –®–∞–≥ 5: –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å

**TranslationService.php:**
```php
class TranslationService {
    private $textsCollection;
    private $currentLanguage;
    
    public function get($key, $default = null) {
        $text = $this->textsCollection->findOne(['key' => $key]);
        return $text['translations'][$this->currentLanguage] ?? $default;
    }
}
```

### –®–∞–≥ 6: Frontend —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**index.php:**
```php
<?php
require 'classes/MenuCache.php';
require 'classes/TranslationService.php';

$menuCache = new MenuCache();
$translation = new TranslationService();
$menu = $menuCache->getMenu();
?>

<html>
<head>
    <title><?php echo $translation->get('site.title'); ?></title>
</head>
<body>
    <h1><?php echo $translation->get('menu.title'); ?></h1>
    <?php foreach ($menu['products'] as $product): ?>
        <div><?php echo $product['product_name']; ?></div>
    <?php endforeach; ?>
</body>
</html>
```

### –®–∞–≥ 7: Webhook –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π

**webhook-handler.php:**
```php
<?php
$apiKey = $_ENV['SEPAY_INCOMING_API_TOKEN'];
$receivedKey = str_replace('Apikey ', '', $_SERVER['HTTP_AUTHORIZATION']);

if ($receivedKey !== $apiKey) {
    http_response_code(401);
    exit;
}

$data = json_decode(file_get_contents('php://input'), true);

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ MongoDB
$client = new MongoDB\Client($_ENV['MONGODB_URL']);
$db = $client->{$_ENV['MONGODB_DB_NAME']};
$db->sepay_transactions->insertOne($data);

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
$telegram = new TelegramService();
$telegram->sendPaymentNotification($data);

echo json_encode(['success' => true]);
```

### –®–∞–≥ 8: PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**backend/ecosystem.config.js:**
```javascript
module.exports = {
  apps: [{
    name: 'veranda-backend',
    script: 'server.js',
    cwd: '/path/to/backend',
    env: {
      NODE_ENV: 'production',
      PORT: 3003
    },
    instances: 1,
    exec_mode: 'fork',
    autorestart: true
  }]
};
```

### –®–∞–≥ 9: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (Nginx)

```nginx
server {
    listen 80;
    server_name veranda.my;
    root /var/www/veranda_my_usr/data/www/veranda.my;
    index index.php;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
    }
}
```

---

## üéì –ö–õ–Æ–ß–ï–í–´–ï –ö–û–ù–¶–ï–ü–¶–ò–ò

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–Ω—é

**–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```
Poster API ‚Üí Backend (5 –º–∏–Ω) ‚Üí MongoDB (30 –º–∏–Ω) ‚Üí PHP (request)
```

**–ü–æ—á–µ–º—É:**
- Poster API - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
- –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –±–ª—é–¥

**–•–∞—Ä–¥–∫–æ–¥-—Å–ª–æ–≤–∞—Ä—å** –≤ `MenuCache.php`:
```php
private function autoTranslateProductName($name, $language) {
    $translations = [
        'en' => ['–®–∞—É—Ä–º–∞' => 'Shawarma', ...],
        'vi' => ['–®–∞—É—Ä–º–∞' => 'Shawarma', ...]
    ];
    return $translations[$language][$name] ?? $name;
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä–æ (–±–µ–∑ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API)
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ (—Ç–æ—á–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã)
- –†–∞—Å—à–∏—Ä—è–µ–º–æ (–ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ)

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. SePay ‚Üí Webhook (–ø—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞)
2. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ MongoDB
4. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
5. –ü–æ–º–µ—Ç–∫–∞ –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ
6. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö

**–ó–∞—â–∏—Ç–∞:**
- API –∫–ª—é—á –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 4. –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å

**3-—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞:**
1. **MongoDB** - –ø–µ—Ä–µ–≤–æ–¥—ã UI (–≥–∏–±–∫–æ)
2. **Hardcode** - –ø–µ—Ä–µ–≤–æ–¥—ã –±–ª—é–¥ (–±—ã—Å—Ç—Ä–æ)
3. **Fallback** - —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)

---

## üìñ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

**Backend (package.json):**
```json
{
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "axios": "^1.6.0",
    "mongodb": "^6.3.0",
    "dotenv": "^16.3.1",
    "helmet": "^7.1.0",
    "compression": "^1.7.4",
    "morgan": "^1.10.0",
    "express-rate-limit": "^7.1.5",
    "express-slow-down": "^2.0.1"
  }
}
```

**Frontend (composer.json):**
```json
{
  "require": {
    "mongodb/mongodb": "^1.17",
    "vlucas/phpdotenv": "^5.5"
  }
}
```

### –í–Ω–µ—à–Ω–∏–µ API –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **Poster API:** https://dev.joinposter.com/docs/v3
- **SePay API:** https://my.sepay.vn/
- **Telegram Bot API:** https://core.telegram.org/bots/api
- **MongoDB PHP:** https://www.mongodb.com/docs/drivers/php/

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø –ù–û–í–û–ì–û –ü–†–û–ï–ö–¢–ê

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Node.js 18+
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω PHP 8.x —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ MongoDB 7.x
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Nginx
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω PM2
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω SSH –¥–æ—Å—Ç—É–ø

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- [ ] –°–æ–∑–¥–∞–Ω .env —Ñ–∞–π–ª —Å –≤—Å–µ —Ç–æ–∫–µ–Ω–∞–º–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω CORS –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞
- [ ] –ü–æ—Ä—Ç backend —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (3003)
- [ ] MongoDB DB_NAME –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Webhook URL –æ–±–Ω–æ–≤–ª–µ–Ω –≤ SePay
- [ ] Telegram bot —Ç–æ–∫–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] MongoDB –∑–∞–ø—É—â–µ–Ω–∞
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã

### –°–µ—Ä–≤–∏—Å—ã
- [ ] Backend –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ PM2
- [ ] Telegram bot –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ PM2
- [ ] PM2 —Å–æ—Ö—Ä–∞–Ω–µ–Ω (pm2 save)
- [ ] PM2 startup –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –°–µ—Ä–≤–∏—Å—ã –∞–≤—Ç–æ—Å—Ç–∞—Ä—Ç—É—é—Ç

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [ ] Poster API —Ç–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] SePay webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Telegram bot –æ—Ç–≤–µ—á–∞–µ—Ç
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç

### –î–µ–ø–ª–æ–π
- [ ] Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] SSH –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] deploy.sh —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Cron –∑–∞–¥–∞—á–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] –ú–µ–Ω—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –°–æ–±—ã—Ç–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è
- [ ] –ö–æ—Ä–∑–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ó–∞–∫–∞–∑—ã —Å–æ–∑–¥–∞—é—Ç—Å—è
- [ ] Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

1. **–ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å .env** –≤ Git
2. **–í–°–ï–ì–î–ê –¥–µ–ª–∞—Ç—å backup** –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –ë–î
3. **–í–°–ï–ì–î–ê —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
4. **–ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å** MongoDB –±–µ–∑ backup
5. **–í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è—Ç—å** –ª–æ–≥–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ –ò –†–ï–°–£–†–°–´

- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** github.com:zapleoceo/restpublic.git
- **–°–µ—Ä–≤–µ—Ä:** 159.253.23.113
- **–î–æ–º–µ–Ω:** veranda.my
- **SSH Alias:** veranda
- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** zapleo.com

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**  
–í–µ—Ä—Å–∏—è 2.0 - –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ veranda.my  
–î–∞—Ç–∞: 03.10.2025

