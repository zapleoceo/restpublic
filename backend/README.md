# North Republic Backend API

Backend —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Poster API –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—é –¥–ª—è —Å–∞–π—Ç–∞ North Republic.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
npm install
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `config.env.example` –≤ `config.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
cp config.env.example config.env
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `POSTER_API_TOKEN` - —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Poster API
- `PORT` - –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3002)

### –ó–∞–ø—É—Å–∫
```bash
# –ü—Ä–æ–¥–∞–∫—à–Ω
npm start

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev
```

## üì° API Endpoints

### Health Check
```
GET /api/health
```

### –ú–µ–Ω—é
```
GET /api/menu                    # –ü–æ–ª–Ω–æ–µ –º–µ–Ω—é (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + –ø—Ä–æ–¥—É–∫—Ç—ã)
GET /api/menu/categories         # –¢–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
GET /api/menu/popular?limit=5    # –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
GET /api/menu/categories/:id/products  # –ü—Ä–æ–¥—É–∫—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
GET /api/menu/products/:id       # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç
```

### Poster API Proxy
```
GET /api/poster/:method          # –ü—Ä–æ–∫—Å–∏ –¥–ª—è Poster API –º–µ—Ç–æ–¥–æ–≤
POST /api/poster/:method         # POST –∑–∞–ø—Ä–æ—Å—ã –∫ Poster API
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º
```
GET /api/menu/cache/stats        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
POST /api/menu/cache/clear       # –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `PORT` | –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ | 3002 |
| `NODE_ENV` | –û–∫—Ä—É–∂–µ–Ω–∏–µ | production |
| `POSTER_API_TOKEN` | –¢–æ–∫–µ–Ω Poster API | - |
| `POSTER_API_BASE_URL` | –ë–∞–∑–æ–≤—ã–π URL Poster API | https://joinposter.com/api |
| `CACHE_TTL` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ (–º—Å) | 300000 (5 –º–∏–Ω) |
| `CORS_ORIGIN` | –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π origin | https://veranda.my |

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏**: –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç
- **–ü—Ä–æ–¥—É–∫—Ç—ã**: –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç  
- **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã**: –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 30 –º–∏–Ω—É—Ç
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂**: –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è
```json
{
  "category_id": "123",
  "name": "–ö–æ—Ñ–µ",
  "name_en": "Coffee",
  "visible": "1"
}
```

### –ü—Ä–æ–¥—É–∫—Ç
```json
{
  "product_id": "456",
  "name": "–≠—Å–ø—Ä–µ—Å—Å–æ",
  "name_en": "Espresso",
  "description": "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —ç—Å–ø—Ä–µ—Å—Å–æ",
  "price": "15000",
  "price_normalized": 150.00,
  "price_formatted": "150.00",
  "image_url": "https://joinposter.com/api/image?image_id=789&size=300x300",
  "category_id": "123",
  "hidden": "0",
  "spots": [
    {
      "spot_id": "1",
      "visible": "1"
    }
  ]
}
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –¢–æ–∫–µ–Ω Poster API —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–º–µ–Ω–∞ veranda.my
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Poster API –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ backend
- Helmet.js –¥–ª—è –∑–∞—â–∏—Ç—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Morgan –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤:
- –§–æ—Ä–º–∞—Ç: `combined`
- –í–∫–ª—é—á–∞–µ—Ç IP, –≤—Ä–µ–º—è, –º–µ—Ç–æ–¥, —Å—Ç–∞—Ç—É—Å, —Ä–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üîÑ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### PM2
```bash
pm2 start server.js --name veranda-backend
pm2 save
pm2 startup
```

### Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
docker build -t veranda-backend .
docker run -p 3002:3002 veranda-backend
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs veranda-backend`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `pm2 status`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `pm2 restart veranda-backend`
